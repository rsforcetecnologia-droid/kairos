import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as g}from"./firebase-config-C2tbVz-J.js";import{setPersistence as b,browserLocalPersistence as B,signInWithEmailAndPassword as P}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";import"https://www.gstatic.com/firebasejs/11.6.1/firebase-messaging.js";const x="pk_test_51STpHSAIZNC4mWLrbapCgFGi2o6tMg07vyFa22LKwGOpN4nNdO0KzB6S4ioHsz4YiQXWrFPn8dVuYgkl0xnCHl2l000K2JtygR",w=Stripe(x),T=w.elements(),L={base:{color:"#ffffff",fontFamily:'"Inter", sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#94a3b8"}},invalid:{color:"#f87171",iconColor:"#f87171"}},E=T.create("card",{style:L,hidePostalCode:!0});E.mount("#card-element");let p;const I=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,v=/Android/.test(navigator.userAgent),S=I||v;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),p=e});const M=new URLSearchParams(window.location.search),y=M.get("planId"),k={lancamento_mensal:85.9,lancamento_semestral:438.09,lancamento_anual:721.56};document.addEventListener("DOMContentLoaded",()=>{const e=new Date,t=new Date(e);t.setDate(e.getDate()+7);const n=t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),o=document.getElementById("charge-date-display");o&&(o.innerText=n),y&&C(y)});function C(e){const t=document.getElementById("plan-price-val"),n=document.getElementById("plan-name-display"),o=document.getElementById("plan-period-text"),s=document.getElementById("installments-wrapper"),a=document.getElementById("installmentsCount");let c=k[e]||0,i=1;if(e.includes("mensal")?(n&&(n.innerText="Plano Unlimited - Mensal"),t&&(t.innerText="R$ 85,90"),o&&(o.innerText="/mês"),s&&s.classList.remove("visible")):e.includes("semestral")?(n&&(n.innerText="Plano Unlimited - Semestral"),t&&(t.innerText="R$ 438,09"),o&&(o.innerText="/semestre"),s&&s.classList.add("visible"),i=6):e.includes("anual")&&(n&&(n.innerText="Plano Unlimited - Anual"),t&&(t.innerText="R$ 721,56"),o&&(o.innerText="/ano"),s&&s.classList.add("visible"),i=12),a&&i>1){a.innerHTML="";const r=document.createElement("option");r.value=1,r.text=`1x de R$ ${c.toFixed(2).replace(".",",")} (À vista)`,a.add(r);for(let l=2;l<=i;l++){let u=c/l;const f=document.createElement("option");f.value=l,f.text=`${l}x de R$ ${u.toFixed(2).replace(".",",")} sem juros`,a.add(f)}a.value=i}}const h=document.getElementById("registerForm"),d=document.getElementById("btnRegister"),m=document.getElementById("errorMsg");h&&h.addEventListener("submit",async e=>{e.preventDefault(),d.disabled=!0;const t=d.innerHTML;d.innerHTML='<i class="ph ph-circle-notch loader" style="display:inline-block"></i> Processando...',m&&(m.style.display="none");const n=document.getElementById("email").value,o=document.getElementById("password").value,s=parseInt(document.getElementById("installmentsCount")?.value)||1;try{const{paymentMethod:a,error:c}=await w.createPaymentMethod({type:"card",card:E,billing_details:{name:document.getElementById("name").value,email:n,phone:document.getElementById("phone").value}});if(c)throw new Error(c.message);const i={establishmentName:document.getElementById("establishmentName").value,establishmentId:document.getElementById("establishmentId")?.value||"",ownerName:document.getElementById("name").value,ownerEmail:n,ownerPassword:o,phone:document.getElementById("phone").value,planId:y,paymentMethodId:a.id,installments:s,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},r=await fetch("https://kairos-app-407358446276.us-central1.run.app/api/public/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await r.json();if(!r.ok)throw new Error(l.message||"Erro ao processar assinatura.");d.innerHTML='<i class="ph ph-check"></i> Sucesso! Entrando...',await b(g,B),await P(g,n,o);const u=window.matchMedia("(display-mode: standalone)").matches;S&&!u?D():window.location.href="app.html"}catch(a){console.error(a),m?(m.textContent=a.message,m.style.display="block"):alert(a.message),d.disabled=!1,d.innerHTML=t}});function D(){const e=document.getElementById("pwa-success-modal"),t=document.getElementById("pwa-install-btn"),n=document.getElementById("pwa-ios-hint"),o=document.getElementById("ios-arrow"),s=document.getElementById("pwa-skip-btn");e&&(e.style.display="flex"),I?(n&&(n.style.display="block"),o&&(o.style.display="block")):v&&t&&(t.style.display="block",t.onclick=async()=>{if(p){p.prompt();const{outcome:a}=await p.userChoice;a==="accepted"&&setTimeout(()=>window.location.href="app.html",2e3),p=null}else alert("Toque no menu do navegador e escolha 'Instalar aplicativo'.")}),s&&(s.onclick=()=>{window.location.href="app.html"})}
