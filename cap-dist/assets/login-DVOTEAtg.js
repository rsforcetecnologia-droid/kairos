import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as u}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getAuth as g,signInWithEmailAndPassword as b,sendPasswordResetEmail as p}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";const y={apiKey:"AIzaSyAlJaPEW5-yOb-8wkB8EJZhAML2M2yI8Ao",authDomain:"kairos-system.firebaseapp.com",projectId:"kairos-system",storageBucket:"kairos-system.appspot.com",messagingSenderId:"603994960586",appId:"1:603994960586:web:30d2c030eed3c55eccfa33",measurementId:"G-SVHFXKV5EC"},f=u(y),d=g(f),E=document.getElementById("loginForm"),a=document.getElementById("loginButton"),n=document.getElementById("errorMessage"),h=document.getElementById("forgotPasswordLink"),r=document.getElementById("resetPasswordModal"),v=document.getElementById("resetPasswordModalContent");E.addEventListener("submit",async t=>{t.preventDefault();const o=document.getElementById("email").value,s=document.getElementById("password").value;a.disabled=!0,a.textContent="A entrar...",n.classList.add("hidden");try{const m=await(await b(d,o,s)).user.getIdTokenResult(),{establishmentId:c,role:i}=m.claims;c&&(i==="owner"||i==="employee")?window.location.href="index.html":(n.textContent="Acesso negado. Verifique as suas permissões.",n.classList.remove("hidden"),d.signOut())}catch(e){e.code==="auth/user-not-found"||e.code==="auth/wrong-password"||e.code==="auth/invalid-credential"?n.textContent="E-mail ou senha inválidos.":n.textContent="Ocorreu um erro ao tentar entrar.",n.classList.remove("hidden")}finally{a.disabled=!1,a.textContent="Entrar"}});h.addEventListener("click",t=>{t.preventDefault(),v.innerHTML=`
                <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">Redefinir Senha</h2>
                <p class="text-center text-gray-500 mb-6">Insira o seu e-mail para receber um link de redefinição.</p>
                <form id="resetPasswordForm">
                    <div class="mb-4">
                        <label for="resetEmail" class="block mb-2 text-sm font-medium text-gray-900">E-mail</label>
                        <input type="email" id="resetEmail" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg" required>
                    </div>
                    <div id="resetMessage" class="hidden text-center text-sm mb-4"></div>
                    <button type="submit" id="sendResetLinkBtn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">Enviar Link</button>
                    <button type="button" id="closeModalBtn" class="w-full mt-2 text-gray-600 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100">Cancelar</button>
                </form>
            `,r.classList.remove("hidden"),document.getElementById("resetPasswordForm").addEventListener("submit",x)});const x=async t=>{t.preventDefault();const o=document.getElementById("resetEmail").value,s=document.getElementById("sendResetLinkBtn"),e=document.getElementById("resetMessage");s.disabled=!0,s.textContent="A enviar...",e.classList.add("hidden");try{await p(d,o),e.textContent="Link enviado com sucesso! Verifique o seu e-mail (incluindo a pasta de spam).",e.className="text-center text-sm mb-4 text-green-600",e.classList.remove("hidden"),document.getElementById("resetPasswordForm").reset()}catch{e.textContent="Erro: Não foi possível enviar o e-mail. Verifique se o endereço está correto.",e.className="text-center text-sm mb-4 text-red-500",e.classList.remove("hidden")}finally{s.disabled=!1,s.textContent="Enviar Link"}};r.addEventListener("click",t=>{(t.target===r||t.target.id==="closeModalBtn")&&r.classList.add("hidden")});
