import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as d}from"./firebase-config-DnrQqYxH.js";import{signOut as m,onAuthStateChanged as u}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";function p(e){const t=document.getElementById("sidebar"),n={establishments:{href:"/admin",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>',text:"Estabelecimentos"},import:{href:"/import",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>',text:"Importação"},dbexplorer:{href:"/dbexplorer",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4M4 7l8 4 8-4m-8 4v8" /></svg>',text:"DB Explorer"}};t.innerHTML=`
        <div class="p-4 flex items-center justify-between border-b border-gray-800 h-16">
             <div class="sidebar-header-text overflow-hidden transition-all duration-300 ease-in-out">
                <h1 class="text-xl font-bold text-white">KAIROS</h1>
            </div>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            ${Object.entries(n).map(([o,s])=>`
                <a href="${s.href}" class="sidebar-link w-full flex items-center gap-3 py-2 px-4 rounded-lg font-semibold ${o===e?"text-white bg-gray-700":"text-gray-300 hover:bg-gray-700"}">
                    ${s.icon}
                    <span class="sidebar-text">${s.text}</span>
                </a>
            `).join("")}
        </nav>
    `}function h(e){const t=document.getElementById("userDisplayEmail"),n=document.getElementById("logoutButton");t&&(t.textContent=e.email),n&&n.addEventListener("click",()=>{const o=getAuth();m(o)})}let r=null;const c=window.location.origin;async function g(e,t={}){if(!r)throw new Error("Usuário não autenticado.");const n=await fetch(`${c}${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},...t}),o=await n.json().catch(()=>({message:n.statusText}));if(!n.ok)throw new Error(o.message||"Ocorreu um erro.");return o}u(d,async e=>{if(e){if(r=await e.getIdToken(),(await e.getIdTokenResult()).claims.role!=="super-admin"){window.location.href="/admin-login.html";return}p("import"),h(e),f()}else window.location.href="/admin-login.html"});async function f(){const e=document.getElementById("establishmentSelect");try{const t=await g("/api/admin/establishments");e.innerHTML=t.map(n=>`<option value="${n.id}">${n.name}</option>`).join("")}catch(t){console.error("Erro ao carregar estabelecimentos:",t)}}document.getElementById("file-upload").addEventListener("change",e=>{const t=e.target.files[0];t&&(document.getElementById("fileName").textContent=t.name)});document.getElementById("submitImport").addEventListener("click",async()=>{const e=document.getElementById("establishmentSelect").value,t=document.getElementById("importType").value,o=document.getElementById("file-upload").files[0],s=document.getElementById("importResult");if(!o){s.innerHTML='<p class="text-red-500">Por favor, selecione um arquivo.</p>';return}const i=new FormData;i.append("dataFile",o),s.innerHTML='<p class="text-blue-500">Enviando e processando... Aguarde.</p>';try{const a=await fetch(`${c}/api/import/${e}/${t}`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:i}),l=await a.json();if(a.ok)s.innerHTML=`<p class="text-green-500">${l.message}</p>`;else throw new Error(l.message)}catch(a){s.innerHTML=`<p class="text-red-500">Erro: ${a.message}</p>`}});
